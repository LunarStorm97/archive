name: Upload to Release

on:    
  workflow_dispatch:    
    inputs:    
      DOWNLOAD_URL:    
        description: "DOWNLOAD_URL"    
        required: true    
        default: "https://testfile.org/1.3GBiconpng"    
    
jobs:    
  release:    
    runs-on: ubuntu-latest    
    steps:    
      - name: Prepare environment    
        run: |    
          sudo mkdir -p /mnt/workspace        
          sudo chown $USER:$USER /mnt/workspace    
    
      - name: Download    
        run: |    
          wget --content-disposition "${{ github.event.inputs.DOWNLOAD_URL }}" -P /mnt/workspace    
          FILE_NAME=$(ls /mnt/workspace)    
          FILE_SIZE=$(stat -c %s /mnt/workspace/$FILE_NAME)    
          echo "FILE_NAME=$FILE_NAME" >> $GITHUB_ENV    
          echo "FILE_SIZE=$FILE_SIZE" >> $GITHUB_ENV    
      
      - name: Split file if larger than 2GB    
        run: |    
          # Convert 2GB to bytes for comparison
          TWO_GB=$((2 * 1024 * 1024 * 1024))    
          if [ $FILE_SIZE -ge $TWO_GB ]; then    
            echo "File is larger than 2GB, splitting..."    
            split -b 1024m /mnt/workspace/$FILE_NAME /mnt/workspace/${FILE_NAME}.part    
            echo "Files split into 1GB parts."    
            # Update the FILE_NAME to the split files    
            FILE_NAME="${FILE_NAME}.part*"    
          fi    
        shell: bash
    
      - name: GH Release    
        uses: softprops/action-gh-release@v2.2.1    
        with:    
          body: |    
            DOWNLOAD URL: ${{ github.event.inputs.DOWNLOAD_URL }}    
          files: /mnt/workspace/${{ env.FILE_NAME }}    
          name: ${{ env.FILE_NAME }}    
          tag_name: ${{ env.FILE_NAME }}
